pipeline {
    agent any
    stages {
/*        stage('Checkout jenkins') {
#           steps {
#               script {
#                   git credentialsId: '1c0c8f42-8c9c-4e4f-a18c-22588c44a186',
#                   url: 'https://github.com/kartgitjan/jenkinsrepo'
#                   branch: 'main'
#              }
#           }
#       } */
       
        stage('Build and Push Docker Image') {
            steps {
                script {
                    def dockerImageTag = "us-east4-docker.pkg.dev/infgprj-gss-n-iacbst-gl-01/jenkins/hello-world:${BUILD_NUMBER}" // or your desired tag
                    docker.build(dockerImageTag, "-f hello-world-docker/dockerfile .")
                    docker.withRegistry('https://us-east4-docker.pkg.dev', 'gcpkey') {
                        docker.image(dockerImageTag).push()
                    }
                }
            }
        }
       stage('Checkout kube') {
           steps {
               script {
                   git credentialsId: '1c0c8f42-8c9c-4e4f-a18c-22588c44a186',
                   url: 'https://github.com/kartgitjan/kubedeploy'
                   branch: 'main'
              }
           }
       }
    }
}

